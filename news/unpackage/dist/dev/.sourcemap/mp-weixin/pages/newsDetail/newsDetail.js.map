{"version":3,"file":"newsDetail.js","sources":["pages/newsDetail/newsDetail.vue","../../../program/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbmV3c0RldGFpbC9uZXdzRGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\n\t<!-- 1. 绑定根 class，应用主题和字体 -->\n\t<view class=\"container\" :class=\"[appTheme, appFontSize]\">\n\t\t<!-- 核心内容区：可滚动 -->\n\t\t<view v-if=\"news\" class=\"detail-wrapper\">\n\t\t\t<view class=\"detail-header\">\n\t\t\t\t<!-- 2. \"高级感\" 标题 -->\n\t\t\t\t<text class=\"detail-title\">{{ news.title }}</text>\n\t\t\t\t<view class=\"detail-meta\">\n\t\t\t\t\t<view class=\"meta-item\">来源：<text class=\"highlight\">{{ news.source }}</text></view>\n\t\t\t\t\t<view class=\"meta-item\">时间：<text class=\"highlight\">{{ news.date }}</text></view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 3. 正文使用 CSS 变量控制字体 -->\n\t\t\t<view class=\"detail-content\">{{ news.content }}</view>\n\t\t\t\n\t\t\t<!-- === 收藏按钮区域：放在内容流中 === -->\n\t\t\t<view class=\"collection-area\">\n\t\t\t\t<button \n\t\t\t\t\tclass=\"collect-btn\" \n\t\t\t\t\t:class=\"{ 'is-collected': isCollected }\" \n\t\t\t\t\t@click=\"toggleCollection\"\n\t\t\t\t>\n\t\t\t\t\t{{ isCollected ? '✓ 已收藏' : '+ 加入收藏' }}\n\t\t\t\t</button>\n\t\t\t</view>\n\t\t\t<!-- ==================================== -->\n\t\t\t\n\t\t\t<view class=\"brand-footer\">—— 由 金建楠 App 提供 ——</view>\n\t\t</view>\n\t\t\n\t\t<view v-else class=\"loading-state\">\n\t\t\t正在加载新闻详情...\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport { getNewsById } from '../../common/newsService.js';\nimport { settingsMixin } from '../../common/settingsMixin.js';\n\nexport default {\n\t// 混入设置（用于主题和字体大小）\n\tmixins: [settingsMixin],\n\tdata() {\n\t\treturn {\n\t\t\tnews: null,\n\t\t\tnewsId: null,\n\t\t\tisCollected: false\n\t\t};\n\t},\n\tonLoad(options) {\n\t\tif (!options.id) {\n\t\t\tuni.showToast({ title: '新闻ID无效', icon: 'error' });\n\t\t\treturn;\n\t\t}\n\t\tthis.newsId = parseInt(options.id);\n\t\tthis.loadNewsDetail();\n\t\tthis.checkCollectionStatus();\n\t},\n\tmethods: {\n\t\t// 加载新闻详情数据\n\t\tasync loadNewsDetail() {\n\t\t\ttry {\n\t\t\t\tthis.news = await getNewsById(this.newsId);\n\t\t\t\tif (this.news) {\n\t\t\t\t\tthis.addReadingHistory();\n\t\t\t\t} else {\n\t\t\t\t\tuni.showToast({ title: '未找到该新闻', icon: 'none' });\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"加载详情失败\", error);\n\t\t\t}\n\t\t},\n\t\t// 检查收藏状态\n\t\tcheckCollectionStatus() {\n\t\t\tconst collections = uni.getStorageSync('collections') || [];\n\t\t\t// 检查当前新闻ID是否在收藏列表中\n\t\t\tthis.isCollected = collections.some(item => item.id === this.newsId);\n\t\t},\n\t\t// 切换收藏状态\n\t\ttoggleCollection() {\n\t\t\tif (!this.news) return;\n\t\t\tlet collections = uni.getStorageSync('collections') || [];\n\t\t\t\n\t\t\tif (this.isCollected) {\n\t\t\t\t// 取消收藏\n\t\t\t\tcollections = collections.filter(item => item.id !== this.newsId);\n\t\t\t\tthis.isCollected = false;\n\t\t\t\tuni.showToast({ title: '已取消收藏', icon: 'none' });\n\t\t\t} else {\n\t\t\t\t// 加入收藏\n\t\t\t\t// 确保收藏项包含完整信息（如 source, date）\n\t\t\t\tconst { id, title, summary, source, date } = this.news; \n\t\t\t\tconst itemToSave = { id, title, summary, source, date };\n\t\t\t\t\n\t\t\t\t// 避免重复添加\n\t\t\t\tif (!collections.some(item => item.id === this.newsId)) {\n\t\t\t\t\tcollections.unshift(itemToSave);\n\t\t\t\t}\n\t\t\t\tthis.isCollected = true;\n\t\t\t\tuni.showToast({ title: '收藏成功', icon: 'success' });\n\t\t\t}\n\t\t\tuni.setStorageSync('collections', collections);\n\t\t},\n\t\t// 添加到阅读历史记录\n\t\taddReadingHistory() {\n\t\t\tif (!this.news) return;\n\t\t\tlet history = uni.getStorageSync('history') || [];\n\t\t\t\n\t\t\t// 仅保存必要的列表信息\n\t\t\tconst { id, title, summary, source, date } = this.news;\n\t\t\tconst itemToSave = { id, title, summary, source, date };\n\t\t\t\n\t\t\t// 如果已存在，先移除，再添加到最前面\n\t\t\thistory = history.filter(item => item.id !== this.newsId);\n\t\t\thistory.unshift(itemToSave);\n\t\t\t\n\t\t\t// 限制历史记录数量\n\t\t\tif (history.length > 50) {\n\t\t\t\thistory = history.slice(0, 50);\n\t\t\t}\n\t\t\tuni.setStorageSync('history', history);\n\t\t}\n\t}\n};\n</script>\n\n<style>\n/* 使用 CSS 变量 */\n.container {\n\tbackground-color: var(--card-bg-color); \n\tmin-height: 100vh;\n}\n.detail-wrapper {\n\tpadding: 40rpx 30rpx;\n\t/* 按钮回归内容流，减少底部填充 */\n\tpadding-bottom: 40rpx; \n}\n.detail-title {\n\tfont-size: 52rpx; \n\tfont-weight: 700;\n\tcolor: var(--text-color-primary);\n\tline-height: 1.4;\n\tmargin-bottom: 30rpx;\n}\n.detail-meta {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\tpadding: 20rpx 0;\n\tborder-bottom: 1rpx solid var(--border-color);\n\tmargin-bottom: 40rpx;\n\tfont-size: 26rpx;\n\tcolor: var(--text-color-secondary);\n}\n.highlight {\n\tcolor: var(--brand-color);\n\tfont-weight: 500;\n\tmargin-left: 5rpx;\n}\n.detail-content {\n\tfont-size: var(--font-size-base); \n\tcolor: var(--text-color-primary);\n\tline-height: var(--line-height-base); \n\twhite-space: pre-wrap;\n\ttext-align: justify;\n}\n\n/* 按钮居中容器 */\n.collection-area {\n\tpadding: 40rpx 0;\n\ttext-align: center;\n}\n\n/* === 收藏按钮样式：普通定位，统一黑字区分背景/边框 === */\n.collect-btn {\n\t/* 默认状态 (+ 加入收藏): 品牌蓝边框，黑字白底 (确保在白背景上突出) */\n\tbackground-color: transparent; \n\tcolor: var(--text-color-primary); /* 统一黑色文字 */\n\tborder: 2rpx solid var(--brand-color); /* 品牌蓝边框，在白底上突出 */\n\t\n\tfont-size: var(--font-size-base);\n\tpadding: 0 50rpx;\n\tborder-radius: 50rpx;\n\tline-height: 2.8;\n\ttransition: all 0.3s;\n\tmin-width: 300rpx; \n\ttext-align: center;\n\tfont-weight: bold; \n}\n.collect-btn:active {\n\topacity: 0.8;\n}\n.collect-btn.is-collected {\n\t/* 已收藏 (✓ 已收藏): 浅灰底，黑字，浅色边框 (柔和显示已完成操作) */\n\tbackground-color: var(--bg-color); /* 使用页面背景色作为浅色填充 */\n\tcolor: var(--text-color-primary); /* 统一黑色文字 */\n\tborder: 2rpx solid var(--border-color); /* 浅色边框 */\n\tfont-weight: normal; \n}\n/* ==================================== */\n\n.brand-footer {\n\ttext-align: center;\n\tpadding: 40rpx 0;\n\tcolor: var(--text-color-placeholder);\n\tfont-size: 24rpx;\n}\n.loading-state {\n\tpadding: 100rpx 0;\n\ttext-align: center;\n\tcolor: var(--text-color-secondary);\n\tfont-size: 28rpx;\n}\n</style>","import MiniProgramPage from 'E:/project/HBuiderX/news/pages/newsDetail/newsDetail.vue'\nwx.createPage(MiniProgramPage)"],"names":["settingsMixin","uni","getNewsById"],"mappings":";;;;AA0CA,MAAK,YAAU;AAAA;AAAA,EAEd,QAAQ,CAACA,qBAAAA,aAAa;AAAA,EACtB,OAAO;AACN,WAAO;AAAA,MACN,MAAM;AAAA,MACN,QAAQ;AAAA,MACR,aAAa;AAAA;EAEd;AAAA,EACD,OAAO,SAAS;AACf,QAAI,CAAC,QAAQ,IAAI;AAChBC,oBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAM,CAAG;AAChD;AAAA,IACD;AACA,SAAK,SAAS,SAAS,QAAQ,EAAE;AACjC,SAAK,eAAc;AACnB,SAAK,sBAAqB;AAAA,EAC1B;AAAA,EACD,SAAS;AAAA;AAAA,IAER,MAAM,iBAAiB;AACtB,UAAI;AACH,aAAK,OAAO,MAAMC,mBAAW,YAAC,KAAK,MAAM;AACzC,YAAI,KAAK,MAAM;AACd,eAAK,kBAAiB;AAAA,eAChB;AACND,wBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,OAAK,CAAG;AAAA,QAChD;AAAA,MACC,SAAO,OAAO;AACfA,sBAAA,MAAA,MAAA,SAAA,yCAAc,UAAU,KAAK;AAAA,MAC9B;AAAA,IACA;AAAA;AAAA,IAED,wBAAwB;AACvB,YAAM,cAAcA,cAAG,MAAC,eAAe,aAAa,KAAK,CAAA;AAEzD,WAAK,cAAc,YAAY,KAAK,UAAQ,KAAK,OAAO,KAAK,MAAM;AAAA,IACnE;AAAA;AAAA,IAED,mBAAmB;AAClB,UAAI,CAAC,KAAK;AAAM;AAChB,UAAI,cAAcA,cAAG,MAAC,eAAe,aAAa,KAAK,CAAA;AAEvD,UAAI,KAAK,aAAa;AAErB,sBAAc,YAAY,OAAO,UAAQ,KAAK,OAAO,KAAK,MAAM;AAChE,aAAK,cAAc;AACnBA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,OAAK,CAAG;AAAA,aACxC;AAGN,cAAM,EAAE,IAAI,OAAO,SAAS,QAAQ,SAAS,KAAK;AAClD,cAAM,aAAa,EAAE,IAAI,OAAO,SAAS,QAAQ;AAGjD,YAAI,CAAC,YAAY,KAAK,UAAQ,KAAK,OAAO,KAAK,MAAM,GAAG;AACvD,sBAAY,QAAQ,UAAU;AAAA,QAC/B;AACA,aAAK,cAAc;AACnBA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAQ,CAAG;AAAA,MACjD;AACAA,oBAAAA,MAAI,eAAe,eAAe,WAAW;AAAA,IAC7C;AAAA;AAAA,IAED,oBAAoB;AACnB,UAAI,CAAC,KAAK;AAAM;AAChB,UAAI,UAAUA,cAAG,MAAC,eAAe,SAAS,KAAK,CAAA;AAG/C,YAAM,EAAE,IAAI,OAAO,SAAS,QAAQ,SAAS,KAAK;AAClD,YAAM,aAAa,EAAE,IAAI,OAAO,SAAS,QAAQ;AAGjD,gBAAU,QAAQ,OAAO,UAAQ,KAAK,OAAO,KAAK,MAAM;AACxD,cAAQ,QAAQ,UAAU;AAG1B,UAAI,QAAQ,SAAS,IAAI;AACxB,kBAAU,QAAQ,MAAM,GAAG,EAAE;AAAA,MAC9B;AACAA,oBAAAA,MAAI,eAAe,WAAW,OAAO;AAAA,IACtC;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;AC7HA,GAAG,WAAW,eAAe;"}